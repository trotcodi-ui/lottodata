<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>상권 분석 위젯</title>
    <style>
        body { margin: 0; padding: 20px; font-family: sans-serif; }
        .widget-container { border: 1px solid #eee; border-radius: 8px; padding: 20px; }
        h2 { font-size: 1.5em; text-align: center; margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; }
        input, select, button { width: 100%; padding: 8px; box-sizing: border-box; border-radius: 4px; }
        input, select { border: 1px solid #ccc; margin-bottom: 15px; }
        button { background-color: #007BFF; color: white; border: none; cursor: pointer; font-weight: bold; padding: 10px; }
        #map { width: 100%; height: 400px; margin-top: 20px; border: 1px solid #ccc; border-radius: 4px; }
        #result-box { margin-top: 20px; border: 1px solid #eee; background-color: #f9f9f9; padding: 15px; border-radius: 8px; }
        h4 { margin: 0 0 10px 0; }
    </style>
</head>
<body>
    <div class="widget-container">
        <h2>창업? 상권분석 해드릴게요.</h2>
        <div>
            <label for="address">주소 입력:</label>
            <input type="text" id="address" placeholder="예: 서울특별시 강남구 역삼동">
        </div>
        <div>
            <label for="category">업종 선택:</label>
            <select id="category">
                <option value="카페">카페</option>
                <option value="음식점">음식점</option>
                <option value="호프">호프</option>
                <option value="치킨">치킨</option>
                <option value="PC방">PC방</option>
                <option value="병원">병원</option>
                <option value="치과">치과</option>
                <option value="약국">약국</option>
                <option value="편의점">편의점</option>
                <option value="미용실">미용실</option>
            </select>
        </div>
        <button id="searchButton">상권 분석 시작</button>
        <div id="map"></div>
        <div id="result-box">
            <h4>분석 결과</h4>
            <p id="place-count">동종 업종 검색 결과: 0개</p>
        </div>
    </div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=05ac38c4d5bfbb8959adc066d064f463&libraries=services"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var map;
            var markers = [];
            var infowindow = new kakao.maps.InfoWindow({zIndex:1});
            var ps = new kakao.maps.services.Places();
            var geocoder = new kakao.maps.services.Geocoder();
        
            function initMap(lat, lng) {
                var container = document.getElementById('map');
                var options = { center: new kakao.maps.LatLng(lat, lng), level: 3 };
                map = new kakao.maps.Map(container, options);
            }
            
            function searchPlaces() {
                var address = document.getElementById('address').value;
                var category = document.getElementById('category').value;
                
                if (!address) { alert('주소를 입력해주세요.'); return; }
        
                geocoder.addressSearch(address, function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                        initMap(coords.getLat(), coords.getLng());
                        
                        ps.keywordSearch(category, placesSearchCB, {
                            location: coords,
                            radius: 1000
                        });
                    } else { alert('주소를 찾을 수 없습니다.'); }
                });
            }
        
            function placesSearchCB(data, status, pagination) {
                if (status === kakao.maps.services.Status.OK) {
                    removeMarker();
                    var bounds = new kakao.maps.LatLngBounds();
                    var count = 0;
                    for (var i = 0; i < data.length; i++) {
                        displayMarker(data[i]);
                        bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                        count++;
                    }
                    map.setBounds(bounds);
                    document.getElementById('place-count').innerText = "동종 업종 검색 결과: " + count + "개";
                } else { document.getElementById('place-count').innerText = "동종 업종 검색 결과: 0개"; }
            }
        
            function displayMarker(place) {
                var marker = new kakao.maps.Marker({ map: map, position: new kakao.maps.LatLng(place.y, place.x) });
                markers.push(marker);
                kakao.maps.event.addListener(marker, 'click', function() {
                    infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
                    infowindow.open(map, marker);
                });
            }
            
            function removeMarker() {
                for (var i = 0; i < markers.length; i++) { markers[i].setMap(null); }   
                markers = [];
            }
        
            var searchButton = document.getElementById('searchButton');
            if (searchButton) { searchButton.addEventListener('click', searchPlaces); }
        
            initMap(37.566826, 126.9786567); // 서울시청으로 초기화
        });
    </script>
</body>
</html>